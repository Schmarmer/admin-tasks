<Window x:Class="Admin_Tasks.Views.TaskEditView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Admin_Tasks.Converters"
        Title="{Binding Title}" 
        Height="600" Width="500"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        ResizeMode="CanResize"
        MinHeight="500" MinWidth="400">
    
    <Window.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="{Binding Title}"
                   FontSize="24" 
                   FontWeight="Bold"
                   Foreground="{DynamicResource PrimaryTextBrush}"
                   Margin="0,0,0,20"/>
        
        <!-- Form Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!-- Titel -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="Titel *" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <TextBox Text="{Binding TaskTitle, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"/>
                </StackPanel>
                
                <!-- Beschreibung -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="Beschreibung" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             Height="100"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
                
                <!-- Priorit채t -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="Priorit채t" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <ComboBox SelectedItem="{Binding Priority}"
                              Background="{DynamicResource SecondaryBackgroundBrush}"
                              Foreground="{DynamicResource PrimaryTextBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              Padding="10,8">
                        <ComboBoxItem Content="Niedrig"/>
                        <ComboBoxItem Content="Normal"/>
                        <ComboBoxItem Content="Hoch"/>
                        <ComboBoxItem Content="Kritisch"/>
                    </ComboBox>
                </StackPanel>
                
                <!-- Status (nur bei Bearbeitung) -->
                <StackPanel Margin="0,0,0,15" Visibility="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Status" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <ComboBox SelectedItem="{Binding Status}"
                              Background="{DynamicResource SecondaryBackgroundBrush}"
                              Foreground="{DynamicResource PrimaryTextBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              Padding="10,8">
                        <ComboBoxItem Content="Offen"/>
                        <ComboBoxItem Content="In Bearbeitung"/>
                        <ComboBoxItem Content="Abgeschlossen"/>
                    </ComboBox>
                </StackPanel>
                
                <!-- Zugewiesen an -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="Zugewiesen an" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding AvailableUsers}"
                              SelectedItem="{Binding SelectedAssignedUser}"
                              DisplayMemberPath="Username"
                              Background="{DynamicResource SecondaryBackgroundBrush}"
                              Foreground="{DynamicResource PrimaryTextBrush}"
                              BorderBrush="{DynamicResource BorderBrush}"
                              Padding="10,8">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Username}" FontWeight="SemiBold"/>
                                    <TextBlock Text=" - " Margin="5,0"/>
                                    <TextBlock Text="{Binding Role}" 
                                               Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>
                
                <!-- F채lligkeitsdatum -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="F채lligkeitsdatum" 
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding DueDate}"
                                Background="{DynamicResource SecondaryBackgroundBrush}"
                                Foreground="{DynamicResource PrimaryTextBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                Padding="10,8"/>
                </StackPanel>
                
                <!-- Fehlerbereich -->
                <Border Background="{DynamicResource DangerBrush}"
                        CornerRadius="5"
                        Padding="15,10"
                        Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="{Binding ErrorMessage}"
                               Foreground="White"
                               FontWeight="SemiBold"
                               TextWrapping="Wrap"/>
                </Border>
                
            </StackPanel>
        </ScrollViewer>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <Button Content="Abbrechen"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource ModernButtonStyle}"
                    Background="{DynamicResource SecondaryBackgroundBrush}"
                    Foreground="{DynamicResource PrimaryTextBrush}"
                    BorderBrush="{DynamicResource BorderBrush}"
                    Margin="0,0,10,0"
                    Padding="20,10"
                    MinWidth="100"/>
            
            <Button Content="{Binding SaveButtonText}"
                    Command="{Binding SaveCommand}"
                    Style="{StaticResource ModernButtonStyle}"
                    Background="{DynamicResource AccentBrush}"
                    Foreground="White"
                    Padding="20,10"
                    MinWidth="100"
                    IsEnabled="{Binding CanSave}"/>
        </StackPanel>
        
        <!-- Loading Overlay -->
        <Border Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" 
                             Width="100" 
                             Height="20"
                             Margin="0,0,0,10"/>
                <TextBlock Text="Wird gespeichert..."
                           Foreground="White"
                           FontSize="14"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
        
    </Grid>
</Window>